<!DOCTYPE html>
<html>
<head>
<meta charset="UTF-8">
<title>Insert title here</title>
<script>
	//테트리스 화면을 3개로 구성
	//블럭화면, 쌓이는화면, 출력화면
	var arr2d_block = new Array();
	var arr2d_stack = new Array();
	var arr2d_displ = new Array();
	
	//캔버스 그리는법
	var canvas;
	var ctx;
	window.onload = function() {
		init_arr();
		canvas = document.getElementById("canvas");
		if (canvas == null || canvas.getContext == null) return;
		ctx = canvas.getContext("2d");
		draw();
	}
	
	//2차원배열 만들어서 0넣기
	function init_arr(){
		for(var i=0; i<20; i++){
			var row_block = new Array();
			var row_stack = new Array();
			var row_displ = new Array();
			for(var j=0; j<10; j++){
				row_block.push(0);
				row_stack.push(0);
				row_displ.push(0);
			}
			arr2d_block.push(row_block);
			arr2d_stack.push(row_stack);
			arr2d_displ.push(row_displ);
		}
		
		arr2d_stack[19][0] = 2;
		arr2d_stack[19][1] = 2;
		arr2d_stack[19][2] = 2;
		arr2d_stack[19][3] = 2;
		arr2d_stack[19][4] = 2;
		arr2d_stack[19][5] = 2;
		arr2d_stack[19][6] = 2;
		arr2d_stack[19][7] = 2;
		
		console.log(arr2d_block);
		console.log(arr2d_stack);
		console.log(arr2d_displ);
		
	}
	
	//색깔
	var color = ["gray", "yellow", "deepskyblue", "lime", "red", "darkviolet", "blue", "orange"];
	
	//블럭의 모양, 움직였을때 모양, 행값, 열값
	var block_type = 2;
	var block_status = 1;
	var block_i = 0;
	var block_j = 4;
	
	//그림그리기
	function draw() {
		for(var i=0; i<20; i++){
			for(var j=0; j<10; j++){
				var index_color = arr2d_displ[i][j];
				ctx.fillStyle = color[index_color];
				ctx.fillRect(j*20, i*20, 19, 19); // j는 가로, i는 세로
			}
		}
		
	}
	
	//키이벤트
	function fn_keyboard(e){
		var keycode = e.keyCode;
		console.log(keycode);
		
		//32 space, 38 up, 40 down, 37 left, 39 right
		if(keycode == 40){
			block_i++;
		}else if(keycode == 37){
			block_j--;
		}else if(keycode == 39){
			block_j++;
		}
		
		if(keycode == 38){
			changeStatus();
		}
		
		setBlock();
		setDispl();
		
		draw();
		
		console.log(arr2d_displ);
	}
	
	//움직였을때 모양 셋팅
	function changeStatus(){
		//사각형은 아무것도 안함
		if(block_type == 1){
			
		}else if(block_type == 2 || block_type == 3 || block_type == 4){
			if(block_status == 1){
				block_status = 2;
			}else if(block_status == 2){
				block_status = 1;
			}
		}else if(block_type == 5 || block_type == 6 || block_type == 7){
			if(block_status == 1){
				block_status = 2;
			}else if(block_status == 2){
				block_status = 3;
			}else if(block_status == 3){
				block_status = 4;
			}else if(block_status == 4){
				block_status = 1;
			}
		}
	}
	
	//블럭화면 셋팅
	function setBlock(){
		setZero(arr2d_block);
		
		//1 O, 2 I, 3 S, 4 Z, 5 T, 6 J, 7 L
		if(block_type == 1){
			arr2d_block[block_i		][block_j	] = block_type;
			arr2d_block[block_i		][block_j+1	] = block_type;
			arr2d_block[block_i+1	][block_j	] = block_type;
			arr2d_block[block_i+1	][block_j+1	] = block_type;
		}else if(block_type == 2){
			if(block_status == 1){
				arr2d_block[block_i		][block_j	] = block_type;
				arr2d_block[block_i-1	][block_j	] = block_type;
				arr2d_block[block_i+1	][block_j	] = block_type;
				arr2d_block[block_i+2	][block_j	] = block_type;
			}else if(block_status == 2){
				arr2d_block[block_i	][block_j	] = block_type;
				arr2d_block[block_i	][block_j-1	] = block_type;
				arr2d_block[block_i	][block_j+1	] = block_type;
				arr2d_block[block_i	][block_j+2	] = block_type;
			}
		}else if(block_type == 3){
			if(block_status == 1){
				arr2d_block[block_i		][block_j	] = block_type;
				arr2d_block[block_i		][block_j+1	] = block_type;
				arr2d_block[block_i+1	][block_j	] = block_type;
				arr2d_block[block_i+1	][block_j-1	] = block_type;
			}else if(block_status == 2){
				arr2d_block[block_i		][block_j	] = block_type;
				arr2d_block[block_i-1	][block_j	] = block_type;
				arr2d_block[block_i		][block_j+1	] = block_type;
				arr2d_block[block_i+1	][block_j+1	] = block_type;
			}
		}else if(block_type == 4){
			if(block_status == 1){
				arr2d_block[block_i		][block_j	] = block_type;
				arr2d_block[block_i		][block_j-1	] = block_type;
				arr2d_block[block_i+1	][block_j	] = block_type;
				arr2d_block[block_i+1	][block_j+1	] = block_type;
			}else if(block_status == 2){
				arr2d_block[block_i		][block_j	] = block_type;
				arr2d_block[block_i-1	][block_j	] = block_type;
				arr2d_block[block_i		][block_j-1	] = block_type;
				arr2d_block[block_i+1	][block_j-1	] = block_type;
			}
		}else if(block_type == 5){
			if(block_status == 1){
				arr2d_block[block_i		][block_j	] = block_type;
				arr2d_block[block_i-1	][block_j	] = block_type;
				arr2d_block[block_i		][block_j-1	] = block_type;
				arr2d_block[block_i		][block_j+1	] = block_type;
			}else if(block_status == 2){
				arr2d_block[block_i		][block_j	] = block_type;
				arr2d_block[block_i-1	][block_j	] = block_type;
				arr2d_block[block_i		][block_j+1	] = block_type;
				arr2d_block[block_i+1	][block_j	] = block_type;
			}else if(block_status == 3){
				arr2d_block[block_i		][block_j	] = block_type;
				arr2d_block[block_i		][block_j-1	] = block_type;
				arr2d_block[block_i		][block_j+1	] = block_type;
				arr2d_block[block_i+1	][block_j	] = block_type;
			}else if(block_status == 4){
				arr2d_block[block_i		][block_j	] = block_type;
				arr2d_block[block_i-1	][block_j	] = block_type;
				arr2d_block[block_i		][block_j-1	] = block_type;
				arr2d_block[block_i+1	][block_j	] = block_type;
			}
		}else if(block_type == 6){
			if(block_status == 1){
				arr2d_block[block_i		][block_j	] = block_type;
				arr2d_block[block_i-1	][block_j	] = block_type;
				arr2d_block[block_i+1	][block_j	] = block_type;
				arr2d_block[block_i+1	][block_j-1	] = block_type;
			}else if(block_status == 2){
				arr2d_block[block_i		][block_j	] = block_type;
				arr2d_block[block_i-1	][block_j-1	] = block_type;
				arr2d_block[block_i		][block_j-1	] = block_type;
				arr2d_block[block_i		][block_j+1	] = block_type;
			}else if(block_status == 3){
				arr2d_block[block_i		][block_j	] = block_type;
				arr2d_block[block_i-1	][block_j+1	] = block_type;
				arr2d_block[block_i-1	][block_j	] = block_type;
				arr2d_block[block_i+1	][block_j	] = block_type;
			}else if(block_status == 4){
				arr2d_block[block_i		][block_j	] = block_type;
				arr2d_block[block_i		][block_j-1	] = block_type;
				arr2d_block[block_i		][block_j+1	] = block_type;
				arr2d_block[block_i+1	][block_j+1	] = block_type;
			}
		}else if(block_type == 7){
			if(block_status == 1){
				arr2d_block[block_i		][block_j	] = block_type;
				arr2d_block[block_i-1	][block_j	] = block_type;
				arr2d_block[block_i+1	][block_j	] = block_type;
				arr2d_block[block_i+1	][block_j+1	] = block_type;
			}else if(block_status == 2){
				arr2d_block[block_i		][block_j	] = block_type;
				arr2d_block[block_i+1	][block_j-1	] = block_type;
				arr2d_block[block_i		][block_j-1	] = block_type;
				arr2d_block[block_i		][block_j+1	] = block_type;
			}else if(block_status == 3){
				arr2d_block[block_i		][block_j	] = block_type;
				arr2d_block[block_i-1	][block_j-1	] = block_type;
				arr2d_block[block_i-1	][block_j	] = block_type;
				arr2d_block[block_i+1	][block_j	] = block_type;
			}else if(block_status == 4){
				arr2d_block[block_i		][block_j	] = block_type;
				arr2d_block[block_i-1	][block_j+1	] = block_type;
				arr2d_block[block_i		][block_j+1	] = block_type;
				arr2d_block[block_i		][block_j-1	] = block_type;
			}
		}
	}
	
	//출력화면 셋팅(블럭화면과 쌓이는화면 더해서)
	function setDispl(){
		setZero(arr2d_displ);
		for(var i=0; i<arr2d_displ.length; i++){
			for(var j=0; j<arr2d_displ[i].length; j++){
				if(arr2d_block[i][j] != 0){
					arr2d_displ[i][j] = arr2d_block[i][j];
				}
				
				if(arr2d_stack[i][j] != 0){
					arr2d_displ[i][j] = arr2d_stack[i][j];
				}
			}
		}
	}
	
	//배열을 0으로 셋팅
	function setZero(arr2d){
		for(var i=0; i<arr2d.length; i++){
			for(var j=0; j<arr2d[i].length; j++){
				arr2d[i][j] = 0;
			}
		}
	}
</script>
</head>
<body onkeydown="fn_keyboard(event)">
	<canvas id="canvas" width="400" height="700">
		이 브라우저는 캔버스를 지원하지 않습니다.
	</canvas>
</body>
</html>