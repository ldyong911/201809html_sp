<!DOCTYPE html>
<html>
<head>
<meta charset="UTF-8">
<title>Insert title here</title>
<style type="text/css">
	table, tr, td{
		padding : 0px;
		border-collapse: collapse;
	}
	img{
		display:block;
	}
</style>
<script src="jquery-1.12.4.js"></script>
<script type="text/javascript">
	var arr2D = new Array();
	var arr2Dimg = new Array();
	
	function init(){
		//javascript는 2차원배열 개념이 없기 때문에 배열1을 생성후 배열2에 넣어준다 
		for(var i=0; i<10; i++){
			var arrRow = new Array();
			arrRow.push(0);arrRow.push(0);
			arrRow.push(0);arrRow.push(0);
			arrRow.push(0);arrRow.push(0);
			arrRow.push(0);arrRow.push(0);
			arrRow.push(0);arrRow.push(0);
			arr2D.push(arrRow);	
		}
		
		//이미지태그
		var grids = document.getElementsByClassName("grid");
		
		//배열 한개를 생성한후 img태그를 한번에 10줄씩 추가
		for(var i=0; i<grids.length; i+=10){
			var arrRowImg = new Array();
			arrRowImg.push(grids[i+0]);
			arrRowImg.push(grids[i+1]);
			arrRowImg.push(grids[i+2]);
			arrRowImg.push(grids[i+3]);
			arrRowImg.push(grids[i+4]);
			arrRowImg.push(grids[i+5]);
			arrRowImg.push(grids[i+6]);
			arrRowImg.push(grids[i+7]);
			arrRowImg.push(grids[i+8]);
			arrRowImg.push(grids[i+9]);
			arr2Dimg.push(arrRowImg);
		}
		
		console.log(arr2D);
		console.log(arr2Dimg);
		
		//위치를 클릭하면 좌표를 띄우게 alt(말풍선같은역할) 설정
		for(var i=0; i<arr2D.length; i++){
			for(var j=0; j<arr2Dimg.length; j++){
				arr2Dimg[i][j].alt = i + "," + j;
			}
		}
	}
	
	//화면출력
	function myDisplay(){
		for(var i=0; i<arr2D.length; i++){
			for(var j=0; j<arr2Dimg.length; j++){
				arr2Dimg[i][j].src = "01/"+arr2D[i][j]+".jpg";
			}
		}
	}
	
	var arrHistory = new Array();
	var status = 1; //흑돌상태
	
	function fn_keepMemory(){
		var str = "";
		
		for(var i=0; i<arr2D.length; i++){
			for(var j=0; j<arr2D[i].length; j++){
				str += arr2D[i][j];
			}
		}
		
		arrHistory.push(str);
	}
	
	function fn_save(){
		var historys = "";
		var winner = "";
		
		historys = arrHistory+"";
		winner = status;
		
		console.log(historys);
		console.log(winner);
		
		$.ajax({
			type : "post",
			url : "myomok",
			data : {historys: historys,
					winner: winner},
			dataType : "json",

			success : function(data) {
				console.log(data.message);
			},

			error : function(xhr, status, error) {
				console.log("에러!: " + error);
			},

		});
	}
	
	//클릭했을때
	function myClick(obj){
		//안놓아지는 상태면 리턴
		if(status == 0){
			return;
		}
		
		var str_alt = obj.alt;
		var arr_alt = str_alt.split(",");
		var i = Number(arr_alt[0]);
		var j = Number(arr_alt[1]);
		
		if(arr2D[i][j] != 0){
			alert("임마");
			return;
		}
		
		//유저
		arr2D[i][j] = status; //맨처음 흑돌넣기위해 흑돌상태 세팅
		fn_keepMemory();
		myDisplay();
		
		//바둑돌 놓인개수 체크
		var cnt_top = fn_top(i, j);
		var cnt_down = fn_down(i, j);
		
		var cnt_left = fn_left(i, j);
		var cnt_right = fn_right(i, j);
		
		var cnt_topleft = fn_topleft(i, j);
		var cnt_downright = fn_downright(i, j);
		
		var cnt_topright= fn_topright(i, j);
		var cnt_downleft = fn_downleft(i, j);
		
		var arr_cnt = new Array();
		arr_cnt.push(cnt_top + cnt_down + 1);
		arr_cnt.push(cnt_left + cnt_right + 1);
		arr_cnt.push(cnt_topleft + cnt_downright + 1);
		arr_cnt.push(cnt_topright + cnt_downleft + 1);
		
		for(var i=0; i<arr_cnt.length; i++){
			if(arr_cnt[i] == 5){
				if(status == 1){
					fn_save();
					alert("흑돌이 이겼습니다.");
				}
				status = 0; //끝나면 돌이 안놓아지는 상태로 놓음
				return;
			}
		}
		
		//상태바꿔주기
		if(status == 1){
			status = 2;
		}
		
		//==================================================
		
		//컴퓨터
		var arr_return = [-1,-1];
		fn_setStoneByCom(arr_return);
		console.log(arr_return);
		
		var ai_i = arr_return[0];
		var ai_j = arr_return[1];
		arr2D[ai_i][ai_j] = status;
		fn_keepMemory();
		myDisplay();
		
		//바둑돌 놓인개수 체크
		var cnt_top = fn_top(ai_i, ai_j);
		var cnt_down = fn_down(ai_i, ai_j);
		
		var cnt_left = fn_left(ai_i, ai_j);
		var cnt_right = fn_right(ai_i, ai_j);
		
		var cnt_topleft = fn_topleft(ai_i, ai_j);
		var cnt_downright = fn_downright(ai_i, ai_j);
		
		var cnt_topright= fn_topright(ai_i, ai_j);
		var cnt_downleft = fn_downleft(ai_i, ai_j);
		
		var arr_cnt = new Array();
		arr_cnt.push(cnt_top + cnt_down + 1);
		arr_cnt.push(cnt_left + cnt_right + 1);
		arr_cnt.push(cnt_topleft + cnt_downright + 1);
		arr_cnt.push(cnt_topright + cnt_downleft + 1);
		
		for(var i=0; i<arr_cnt.length; i++){
			if(arr_cnt[i] == 5){
				if(status == 2){
					fn_save();
					alert("백돌이 이겼습니다.");
				}
				status = 0; //끝나면 돌이 안놓아지는 상태로 놓음
				return;
			}
		}
		
		//상태바꿔주기
		if(status == 2){
			status = 1;
		}
		
	}
	
	var arr2Dmemory = new Array();
	
	//컴퓨터가 판단
	function fn_setStoneByCom(arr_ref){
		var history = "";
		for(var i=0; i<arr2D.length; i++){
			for(var j=0; j<arr2D[i].length; j++){
				history += arr2D[i][j];
			}
		}
		
		var arr2Dattack = new Array();
		var arr2Ddefense = new Array();
		var arr2Dcenter = new Array();
		var arr2Dsumall = new Array();
		
		//call by reference라서 배열 새로 생성해서 넣어줘야함
		//모두 0으로 셋팅
		for(var i=0; i<arr2D.length; i++){
			var arr_row_a = new Array();
			var arr_row_d = new Array();
			var arr_row_c = new Array();
			var arr_row_s = new Array();
			var arr_row_m = new Array();
			for(var j=0; j<arr2D[i].length; j++){
				arr_row_a.push(0);
				arr_row_d.push(0);
				arr_row_c.push(0);
				arr_row_s.push(0);
				arr_row_m.push(0);
			}
			arr2Dattack.push(arr_row_a);
			arr2Ddefense.push(arr_row_d);
			arr2Dcenter.push(arr_row_c);
			arr2Dsumall.push(arr_row_s);
			arr2Dmemory.push(arr_row_m);
		}
		
		$.ajax({
			type : "get",
			url : "myasync",
			data : {history: history,
					status: status},
			dataType : "json",
			async: false, //비동기예제(비동기는 각각의 다른 작업들을 알아서 처리/동기는 하나의 작업이 끝난후 다음작업 처리)
	
			success : function(data) {
				//이전의 기보가 있으면 이겼는지 졌는지 판단하여 가중치 부여
				for(var i=0; i<data.length; i++){
					var ii = parseInt(data[i].i);
					var jj = parseInt(data[i].j);
					
					if(status == data[i].status){
						arr2Dmemory[ii][jj] = arr2Dmemory[ii][jj]+0.1;
					}else{
						arr2Dmemory[ii][jj] = arr2Dmemory[ii][jj]-0.1;
					}
				}
				console.log("=====================================");
				console.log(data);
				console.log("=====================================");
			},
	
			error : function(xhr, status, error) {
				console.log("에러!: " + error);
			},
		});
		
		//가운데값 판단 가중치
		for(var i=0; i<arr2D.length; i++){
			for(var j=0; j<arr2D[i].length; j++){
				var red_i = (i*i) + (i-arr2D.length)*(i-arr2D.length);
				var black_i = arr2D.length * arr2D.length - red_i;
				
				var red_j = (j*j) + (j-arr2D.length)*(j-arr2D.length);
				var black_j = arr2D.length * arr2D.length - red_j;
				
				arr2Dcenter[i][j] = (black_i + black_j)/100000; //가중치값은 미세하게 부여해야함
			}
		}
		
		
		//공격형값 판단
		for(var i=0; i<arr2D.length; i++){
			for(var j=0; j<arr2D[i].length; j++){
				var cnt_top = fn_top(i, j);
				var cnt_down = fn_down(i, j);
				
				var cnt_left = fn_left(i, j);
				var cnt_right = fn_right(i, j);
				
				var cnt_topleft = fn_topleft(i, j);
				var cnt_downright = fn_downright(i, j);
				
				var cnt_topright= fn_topright(i, j);
				var cnt_downleft = fn_downleft(i, j);
				
				var arr_cnt = new Array();
				arr_cnt.push(cnt_top + cnt_down + 1);
				arr_cnt.push(cnt_left + cnt_right + 1);
				arr_cnt.push(cnt_topleft + cnt_downright + 1);
				arr_cnt.push(cnt_topright + cnt_downleft + 1);
				
				var max = fn_getMaxFromArray(arr_cnt);

				arr2Dattack[i][j] = max * 0.8;
			}
		}
		
		//수비형일때 상대방 값 보기위해 상태 변경
		if(status == 2){
			status = 1;
		}else if(status == 1){
			status = 2;
		}
		
		//수비형값 판단
		for(var i=0; i<arr2D.length; i++){
			for(var j=0; j<arr2D[i].length; j++){
				var cnt_top = fn_top(i, j);
				var cnt_down = fn_down(i, j);
				
				var cnt_left = fn_left(i, j);
				var cnt_right = fn_right(i, j);
				
				var cnt_topleft = fn_topleft(i, j);
				var cnt_downright = fn_downright(i, j);
				
				var cnt_topright= fn_topright(i, j);
				var cnt_downleft = fn_downleft(i, j);
				
				var arr_cnt = new Array();
				arr_cnt.push(cnt_top + cnt_down + 1);
				arr_cnt.push(cnt_left + cnt_right + 1);
				arr_cnt.push(cnt_topleft + cnt_downright + 1);
				arr_cnt.push(cnt_topright + cnt_downleft + 1);
				
				var max = fn_getMaxFromArray(arr_cnt);

				arr2Ddefense[i][j] = max;
			}
		}
		
		//수비형일때 상태 변경한것을 다시 원상복귀
		if(status == 2){
			status = 1;
		}else if(status == 1){
			status = 2;
		}
		
		//모든값 가중치 더하기
		for(var i=0; i<arr2D.length; i++){
			for(var j=0; j<arr2D[i].length; j++){
				arr2Dsumall[i][j] = arr2Dattack[i][j] + arr2Ddefense[i][j] + arr2Dcenter[i][j] + arr2Dmemory[i][j];
			}
		}
		
		//빈곳 찾기
		for(var i=0; i<arr2Dsumall.length; i++){
			for(var j=0; j<arr2Dsumall[i].length; j++){
				if(arr2D[i][j] != 0){
					arr2Dsumall[i][j] = -1;
				}
			}
		}
		
		//가중치가 제일 높은곳 찾기
		var max_all = 0;
		for(var i=0; i<arr2Dsumall.length; i++){
			for(var j=0; j<arr2Dsumall[i].length; j++){
				if(max_all < arr2Dsumall[i][j]){
					max_all = arr2Dsumall[i][j];
				}
			}
		}
		
		console.log(max_all);
		
		//가중치가 제일 높은곳의 i와 j값 구하기
		for(var i=0; i<arr2Dsumall.length; i++){
			for(var j=0; j<arr2Dsumall[i].length; j++){
				if(arr2Dsumall[i][j] == max_all){
					arr_ref[0] = i;
					arr_ref[1] = j;
					return;
				}
			}
		}
		
	}
	
	//최대값 구하기
	function fn_getMaxFromArray(arr){
		var max = 0;
		for(var i=0; i<arr.length; i++){
			if(max < arr[i]){
				max = arr[i];
			}
		}
		
		return max;
	}
	
	function fn_top(i,j){
		var ret_cnt = 0;
		
		while(true){
			i = i-1;
			j = j;
			
			//바둑판 끝에서 체크할때 배열인덱스 벗어나는 에러 try catch
			try {
				if(arr2D[i][j] == status){
					ret_cnt++;
				}else{
					return ret_cnt;
				}
			} catch (e) {
				return ret_cnt;
			}
		}
	}
	
	function fn_down(i,j){
		var ret_cnt = 0;
		
		while(true){
			i = i+1;
			j = j;
			
			try {
				if(arr2D[i][j] == status){
					ret_cnt++;
				}else{
					return ret_cnt;
				}
			} catch (e) {
				return ret_cnt;
			}
		}
	}
	
	function fn_left(i,j){
		var ret_cnt = 0;
		
		while(true){
			i = i;
			j = j-1;
			
			try {
				if(arr2D[i][j] == status){
					ret_cnt++;
				}else{
					return ret_cnt;
				}
			} catch (e) {
				return ret_cnt;
			}
		}
	}
	
	function fn_right(i,j){
		var ret_cnt = 0;
		
		while(true){
			i = i;
			j = j+1;
			
			try {
				if(arr2D[i][j] == status){
					ret_cnt++;
				}else{
					return ret_cnt;
				}
			} catch (e) {
				return ret_cnt;
			}
		}
	}
	
	function fn_topleft(i,j){
		var ret_cnt = 0;
		
		while(true){
			i = i-1;
			j = j-1;
			
			try {
				if(arr2D[i][j] == status){
					ret_cnt++;
				}else{
					return ret_cnt;
				}
			} catch (e) {
				return ret_cnt;
			}
		}
	}
	
	function fn_downright(i,j){
		var ret_cnt = 0;
		
		while(true){
			i = i+1;
			j = j+1;
			
			try {
				if(arr2D[i][j] == status){
					ret_cnt++;
				}else{
					return ret_cnt;
				}
			} catch (e) {
				return ret_cnt;
			}
		}
	}
	
	function fn_topright(i,j){
		var ret_cnt = 0;
		
		while(true){
			i = i-1;
			j = j+1;
			
			try {
				if(arr2D[i][j] == status){
					ret_cnt++;
				}else{
					return ret_cnt;
				}
			} catch (e) {
				return ret_cnt;
			}
		}
	}
	
	function fn_downleft(i,j){
		var ret_cnt = 0;
		
		while(true){
			i = i+1;
			j = j-1;
			
			try {
				if(arr2D[i][j] == status){
					ret_cnt++;
				}else{
					return ret_cnt;
				}
			} catch (e) {
				return ret_cnt;
			}
		}
	}
	
</script>
</head>
<body onload="init()">
<a href="javascript:myDisplay()">화면보기</a>
	<table id="mytable">
		<tr>
			<td><img class="grid" src="01/0.jpg" onclick="myClick(this)"/></td>
			<td><img class="grid" src="01/0.jpg" onclick="myClick(this)"/></td>
			<td><img class="grid" src="01/0.jpg" onclick="myClick(this)"/></td>
			<td><img class="grid" src="01/0.jpg" onclick="myClick(this)"/></td>
			<td><img class="grid" src="01/0.jpg" onclick="myClick(this)"/></td>
			<td><img class="grid" src="01/0.jpg" onclick="myClick(this)"/></td>
			<td><img class="grid" src="01/0.jpg" onclick="myClick(this)"/></td>
			<td><img class="grid" src="01/0.jpg" onclick="myClick(this)"/></td>
			<td><img class="grid" src="01/0.jpg" onclick="myClick(this)"/></td>
			<td><img class="grid" src="01/0.jpg" onclick="myClick(this)"/></td>
		</tr>
		<tr>
			<td><img class="grid" src="01/0.jpg" onclick="myClick(this)"/></td>
			<td><img class="grid" src="01/0.jpg" onclick="myClick(this)"/></td>
			<td><img class="grid" src="01/0.jpg" onclick="myClick(this)"/></td>
			<td><img class="grid" src="01/0.jpg" onclick="myClick(this)"/></td>
			<td><img class="grid" src="01/0.jpg" onclick="myClick(this)"/></td>
			<td><img class="grid" src="01/0.jpg" onclick="myClick(this)"/></td>
			<td><img class="grid" src="01/0.jpg" onclick="myClick(this)"/></td>
			<td><img class="grid" src="01/0.jpg" onclick="myClick(this)"/></td>
			<td><img class="grid" src="01/0.jpg" onclick="myClick(this)"/></td>
			<td><img class="grid" src="01/0.jpg" onclick="myClick(this)"/></td>
		</tr>
		<tr>
			<td><img class="grid" src="01/0.jpg" onclick="myClick(this)"/></td>
			<td><img class="grid" src="01/0.jpg" onclick="myClick(this)"/></td>
			<td><img class="grid" src="01/0.jpg" onclick="myClick(this)"/></td>
			<td><img class="grid" src="01/0.jpg" onclick="myClick(this)"/></td>
			<td><img class="grid" src="01/0.jpg" onclick="myClick(this)"/></td>
			<td><img class="grid" src="01/0.jpg" onclick="myClick(this)"/></td>
			<td><img class="grid" src="01/0.jpg" onclick="myClick(this)"/></td>
			<td><img class="grid" src="01/0.jpg" onclick="myClick(this)"/></td>
			<td><img class="grid" src="01/0.jpg" onclick="myClick(this)"/></td>
			<td><img class="grid" src="01/0.jpg" onclick="myClick(this)"/></td>
		</tr>
		<tr>
			<td><img class="grid" src="01/0.jpg" onclick="myClick(this)"/></td>
			<td><img class="grid" src="01/0.jpg" onclick="myClick(this)"/></td>
			<td><img class="grid" src="01/0.jpg" onclick="myClick(this)"/></td>
			<td><img class="grid" src="01/0.jpg" onclick="myClick(this)"/></td>
			<td><img class="grid" src="01/0.jpg" onclick="myClick(this)"/></td>
			<td><img class="grid" src="01/0.jpg" onclick="myClick(this)"/></td>
			<td><img class="grid" src="01/0.jpg" onclick="myClick(this)"/></td>
			<td><img class="grid" src="01/0.jpg" onclick="myClick(this)"/></td>
			<td><img class="grid" src="01/0.jpg" onclick="myClick(this)"/></td>
			<td><img class="grid" src="01/0.jpg" onclick="myClick(this)"/></td>
		</tr>
		<tr>
			<td><img class="grid" src="01/0.jpg" onclick="myClick(this)"/></td>
			<td><img class="grid" src="01/0.jpg" onclick="myClick(this)"/></td>
			<td><img class="grid" src="01/0.jpg" onclick="myClick(this)"/></td>
			<td><img class="grid" src="01/0.jpg" onclick="myClick(this)"/></td>
			<td><img class="grid" src="01/0.jpg" onclick="myClick(this)"/></td>
			<td><img class="grid" src="01/0.jpg" onclick="myClick(this)"/></td>
			<td><img class="grid" src="01/0.jpg" onclick="myClick(this)"/></td>
			<td><img class="grid" src="01/0.jpg" onclick="myClick(this)"/></td>
			<td><img class="grid" src="01/0.jpg" onclick="myClick(this)"/></td>
			<td><img class="grid" src="01/0.jpg" onclick="myClick(this)"/></td>
		</tr>
		<tr>
			<td><img class="grid" src="01/0.jpg" onclick="myClick(this)"/></td>
			<td><img class="grid" src="01/0.jpg" onclick="myClick(this)"/></td>
			<td><img class="grid" src="01/0.jpg" onclick="myClick(this)"/></td>
			<td><img class="grid" src="01/0.jpg" onclick="myClick(this)"/></td>
			<td><img class="grid" src="01/0.jpg" onclick="myClick(this)"/></td>
			<td><img class="grid" src="01/0.jpg" onclick="myClick(this)"/></td>
			<td><img class="grid" src="01/0.jpg" onclick="myClick(this)"/></td>
			<td><img class="grid" src="01/0.jpg" onclick="myClick(this)"/></td>
			<td><img class="grid" src="01/0.jpg" onclick="myClick(this)"/></td>
			<td><img class="grid" src="01/0.jpg" onclick="myClick(this)"/></td>
		</tr>
		<tr>
			<td><img class="grid" src="01/0.jpg" onclick="myClick(this)"/></td>
			<td><img class="grid" src="01/0.jpg" onclick="myClick(this)"/></td>
			<td><img class="grid" src="01/0.jpg" onclick="myClick(this)"/></td>
			<td><img class="grid" src="01/0.jpg" onclick="myClick(this)"/></td>
			<td><img class="grid" src="01/0.jpg" onclick="myClick(this)"/></td>
			<td><img class="grid" src="01/0.jpg" onclick="myClick(this)"/></td>
			<td><img class="grid" src="01/0.jpg" onclick="myClick(this)"/></td>
			<td><img class="grid" src="01/0.jpg" onclick="myClick(this)"/></td>
			<td><img class="grid" src="01/0.jpg" onclick="myClick(this)"/></td>
			<td><img class="grid" src="01/0.jpg" onclick="myClick(this)"/></td>
		</tr>
		<tr>
			<td><img class="grid" src="01/0.jpg" onclick="myClick(this)"/></td>
			<td><img class="grid" src="01/0.jpg" onclick="myClick(this)"/></td>
			<td><img class="grid" src="01/0.jpg" onclick="myClick(this)"/></td>
			<td><img class="grid" src="01/0.jpg" onclick="myClick(this)"/></td>
			<td><img class="grid" src="01/0.jpg" onclick="myClick(this)"/></td>
			<td><img class="grid" src="01/0.jpg" onclick="myClick(this)"/></td>
			<td><img class="grid" src="01/0.jpg" onclick="myClick(this)"/></td>
			<td><img class="grid" src="01/0.jpg" onclick="myClick(this)"/></td>
			<td><img class="grid" src="01/0.jpg" onclick="myClick(this)"/></td>
			<td><img class="grid" src="01/0.jpg" onclick="myClick(this)"/></td>
		</tr>
		<tr>
			<td><img class="grid" src="01/0.jpg" onclick="myClick(this)"/></td>
			<td><img class="grid" src="01/0.jpg" onclick="myClick(this)"/></td>
			<td><img class="grid" src="01/0.jpg" onclick="myClick(this)"/></td>
			<td><img class="grid" src="01/0.jpg" onclick="myClick(this)"/></td>
			<td><img class="grid" src="01/0.jpg" onclick="myClick(this)"/></td>
			<td><img class="grid" src="01/0.jpg" onclick="myClick(this)"/></td>
			<td><img class="grid" src="01/0.jpg" onclick="myClick(this)"/></td>
			<td><img class="grid" src="01/0.jpg" onclick="myClick(this)"/></td>
			<td><img class="grid" src="01/0.jpg" onclick="myClick(this)"/></td>
			<td><img class="grid" src="01/0.jpg" onclick="myClick(this)"/></td>
		</tr>
		<tr>
			<td><img class="grid" src="01/0.jpg" onclick="myClick(this)"/></td>
			<td><img class="grid" src="01/0.jpg" onclick="myClick(this)"/></td>
			<td><img class="grid" src="01/0.jpg" onclick="myClick(this)"/></td>
			<td><img class="grid" src="01/0.jpg" onclick="myClick(this)"/></td>
			<td><img class="grid" src="01/0.jpg" onclick="myClick(this)"/></td>
			<td><img class="grid" src="01/0.jpg" onclick="myClick(this)"/></td>
			<td><img class="grid" src="01/0.jpg" onclick="myClick(this)"/></td>
			<td><img class="grid" src="01/0.jpg" onclick="myClick(this)"/></td>
			<td><img class="grid" src="01/0.jpg" onclick="myClick(this)"/></td>
			<td><img class="grid" src="01/0.jpg" onclick="myClick(this)"/></td>
		</tr>
		
	</table>
</body>
</html>