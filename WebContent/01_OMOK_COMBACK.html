<!DOCTYPE html>
<html>
<head>
<meta charset="UTF-8">
<title>Insert title here</title>
<style type="text/css">
	table, tr, td{
		padding : 0px;
		border-collapse: collapse;
	}
	img{
		display:block;
	}
</style>
<script src="jquery-1.12.4.js"></script>
<script type="text/javascript">
	var arr2D = new Array();
	var arr2Dimg = new Array();
	
	var arrHistory = new Array(); //이전내용을 저장
	var winner = 0;
	
	var timerId = 0; //setInterval 저장변수
	var index_draw = 0; //시간마다 arrHistory의 인덱스를 증가시키는 변수
	
	function init(){
		//javascript는 2차원배열 개념이 없기 때문에 배열1을 생성후 배열2에 넣어준다 
		for(var i=0; i<10; i++){
			var arrRow = new Array();
			arrRow.push(0);arrRow.push(0);
			arrRow.push(0);arrRow.push(0);
			arrRow.push(0);arrRow.push(0);
			arrRow.push(0);arrRow.push(0);
			arrRow.push(0);arrRow.push(0);
			arr2D.push(arrRow);	
		}
		
		//이미지태그
		var grids = document.getElementsByClassName("grid");
		
		//배열 한개를 생성한후 img태그를 한번에 10줄씩 추가
		for(var i=0; i<grids.length; i+=10){
			var arrRowImg = new Array();
			arrRowImg.push(grids[i+0]);
			arrRowImg.push(grids[i+1]);
			arrRowImg.push(grids[i+2]);
			arrRowImg.push(grids[i+3]);
			arrRowImg.push(grids[i+4]);
			arrRowImg.push(grids[i+5]);
			arrRowImg.push(grids[i+6]);
			arrRowImg.push(grids[i+7]);
			arrRowImg.push(grids[i+8]);
			arrRowImg.push(grids[i+9]);
			arr2Dimg.push(arrRowImg);
		}
		
		console.log(arr2D);
		console.log(arr2Dimg);
		
		//위치를 클릭하면 좌표를 띄우게 alt(말풍선같은역할) 설정
		for(var i=0; i<arr2D.length; i++){
			for(var j=0; j<arr2Dimg.length; j++){
				arr2Dimg[i][j].alt = i + "," + j;
			}
		}
		
		fn_ajax1();
	}
	
	function fn_ajax1(){
		$.ajax({
			type : "get",
// 			url : "mycomback", //상대경로
			url : "http://localhost/GAMESOCKET/mycomback", //절대경로
			data : {param1: 'merryChrismax'},
			dataType : "json",

			success : function(data) {
				renderTable(data);
			},

			error : function(xhr, status, error) {
				console.log("에러!: " + error);
			},

		});
	}
	
	function fn_ajax2(pan){
		$.ajax({
			type : "get",
			url : "http://localhost/GAMESOCKET/mypan",
			data : {pan: pan},
			dataType : "json",

			success : function(data) {
				console.log(data);
				
				for(var i=0; i<data.length; i++){
					arrHistory.push(data[i].history);
				}
				timerId = setInterval("fn_draw()", 1000);
			},

			error : function(xhr, status, error) {
				console.log("에러!: " + error);
			},

		});
	}
	
	function fn_draw(){
		for(var i=0; i<arr2D.length; i++){
			for(var j=0; j<arr2D[i].length; j++){
				var index_sub = i*10 + j;
				arr2D[i][j] = arrHistory[index_draw].substring(index_sub, index_sub+1);
			}
		}
		
		myDisplay();
		index_draw++;
		
		if(arrHistory.length <= index_draw){
			clearInterval(timerId);
			timerId = 0;
		}
	}
	
	function renderTable(data){
		var text = "";
		for(var i=0; i<data.length; i++){
			text += "<tr>";
			text += "	<td onclick='fn_ajax2("+data[i].pan+")'>["+data[i].pan+"] 복기하기</td>";
			text += "</tr>";
		}
		
		$("#my_tbody").html(text);
	}
	
	//화면출력
	function myDisplay(){
		for(var i=0; i<arr2D.length; i++){
			for(var j=0; j<arr2Dimg.length; j++){
				arr2Dimg[i][j].src = "01/"+arr2D[i][j]+".jpg";
			}
		}
	}
</script>
</head>
<body onload="init()">
	<table>
		<thead>
			<tr>
				<td>판순서</td>
			</tr>
		</thead>
		<tbody id="my_tbody">
			<tr>
				<td>__</td>
			</tr>
		</tbody>
	</table>
	
	<table id="mytable">
		<tr>
			<td><img class="grid" src="01/0.jpg"  /></td>
			<td><img class="grid" src="01/0.jpg"  /></td>
			<td><img class="grid" src="01/0.jpg"  /></td>
			<td><img class="grid" src="01/0.jpg"  /></td>
			<td><img class="grid" src="01/0.jpg"  /></td>
			<td><img class="grid" src="01/0.jpg"  /></td>
			<td><img class="grid" src="01/0.jpg"  /></td>
			<td><img class="grid" src="01/0.jpg"  /></td>
			<td><img class="grid" src="01/0.jpg"  /></td>
			<td><img class="grid" src="01/0.jpg"  /></td>
		</tr>
		<tr>
			<td><img class="grid" src="01/0.jpg"  /></td>
			<td><img class="grid" src="01/0.jpg"  /></td>
			<td><img class="grid" src="01/0.jpg"  /></td>
			<td><img class="grid" src="01/0.jpg"  /></td>
			<td><img class="grid" src="01/0.jpg"  /></td>
			<td><img class="grid" src="01/0.jpg"  /></td>
			<td><img class="grid" src="01/0.jpg"  /></td>
			<td><img class="grid" src="01/0.jpg"  /></td>
			<td><img class="grid" src="01/0.jpg"  /></td>
			<td><img class="grid" src="01/0.jpg"  /></td>
		</tr>
		<tr>
			<td><img class="grid" src="01/0.jpg"  /></td>
			<td><img class="grid" src="01/0.jpg"  /></td>
			<td><img class="grid" src="01/0.jpg"  /></td>
			<td><img class="grid" src="01/0.jpg"  /></td>
			<td><img class="grid" src="01/0.jpg"  /></td>
			<td><img class="grid" src="01/0.jpg"  /></td>
			<td><img class="grid" src="01/0.jpg"  /></td>
			<td><img class="grid" src="01/0.jpg"  /></td>
			<td><img class="grid" src="01/0.jpg"  /></td>
			<td><img class="grid" src="01/0.jpg"  /></td>
		</tr>
		<tr>
			<td><img class="grid" src="01/0.jpg"  /></td>
			<td><img class="grid" src="01/0.jpg"  /></td>
			<td><img class="grid" src="01/0.jpg"  /></td>
			<td><img class="grid" src="01/0.jpg"  /></td>
			<td><img class="grid" src="01/0.jpg"  /></td>
			<td><img class="grid" src="01/0.jpg"  /></td>
			<td><img class="grid" src="01/0.jpg"  /></td>
			<td><img class="grid" src="01/0.jpg"  /></td>
			<td><img class="grid" src="01/0.jpg"  /></td>
			<td><img class="grid" src="01/0.jpg"  /></td>
		</tr>
		<tr>
			<td><img class="grid" src="01/0.jpg"  /></td>
			<td><img class="grid" src="01/0.jpg"  /></td>
			<td><img class="grid" src="01/0.jpg"  /></td>
			<td><img class="grid" src="01/0.jpg"  /></td>
			<td><img class="grid" src="01/0.jpg"  /></td>
			<td><img class="grid" src="01/0.jpg"  /></td>
			<td><img class="grid" src="01/0.jpg"  /></td>
			<td><img class="grid" src="01/0.jpg"  /></td>
			<td><img class="grid" src="01/0.jpg"  /></td>
			<td><img class="grid" src="01/0.jpg"  /></td>
		</tr>
		<tr>
			<td><img class="grid" src="01/0.jpg"  /></td>
			<td><img class="grid" src="01/0.jpg"  /></td>
			<td><img class="grid" src="01/0.jpg"  /></td>
			<td><img class="grid" src="01/0.jpg"  /></td>
			<td><img class="grid" src="01/0.jpg"  /></td>
			<td><img class="grid" src="01/0.jpg"  /></td>
			<td><img class="grid" src="01/0.jpg"  /></td>
			<td><img class="grid" src="01/0.jpg"  /></td>
			<td><img class="grid" src="01/0.jpg"  /></td>
			<td><img class="grid" src="01/0.jpg"  /></td>
		</tr>
		<tr>
			<td><img class="grid" src="01/0.jpg"  /></td>
			<td><img class="grid" src="01/0.jpg"  /></td>
			<td><img class="grid" src="01/0.jpg"  /></td>
			<td><img class="grid" src="01/0.jpg"  /></td>
			<td><img class="grid" src="01/0.jpg"  /></td>
			<td><img class="grid" src="01/0.jpg"  /></td>
			<td><img class="grid" src="01/0.jpg"  /></td>
			<td><img class="grid" src="01/0.jpg"  /></td>
			<td><img class="grid" src="01/0.jpg"  /></td>
			<td><img class="grid" src="01/0.jpg"  /></td>
		</tr>
		<tr>
			<td><img class="grid" src="01/0.jpg"  /></td>
			<td><img class="grid" src="01/0.jpg"  /></td>
			<td><img class="grid" src="01/0.jpg"  /></td>
			<td><img class="grid" src="01/0.jpg"  /></td>
			<td><img class="grid" src="01/0.jpg"  /></td>
			<td><img class="grid" src="01/0.jpg"  /></td>
			<td><img class="grid" src="01/0.jpg"  /></td>
			<td><img class="grid" src="01/0.jpg"  /></td>
			<td><img class="grid" src="01/0.jpg"  /></td>
			<td><img class="grid" src="01/0.jpg"  /></td>
		</tr>
		<tr>
			<td><img class="grid" src="01/0.jpg"  /></td>
			<td><img class="grid" src="01/0.jpg"  /></td>
			<td><img class="grid" src="01/0.jpg"  /></td>
			<td><img class="grid" src="01/0.jpg"  /></td>
			<td><img class="grid" src="01/0.jpg"  /></td>
			<td><img class="grid" src="01/0.jpg"  /></td>
			<td><img class="grid" src="01/0.jpg"  /></td>
			<td><img class="grid" src="01/0.jpg"  /></td>
			<td><img class="grid" src="01/0.jpg"  /></td>
			<td><img class="grid" src="01/0.jpg"  /></td>
		</tr>
		<tr>
			<td><img class="grid" src="01/0.jpg"  /></td>
			<td><img class="grid" src="01/0.jpg"  /></td>
			<td><img class="grid" src="01/0.jpg"  /></td>
			<td><img class="grid" src="01/0.jpg"  /></td>
			<td><img class="grid" src="01/0.jpg"  /></td>
			<td><img class="grid" src="01/0.jpg"  /></td>
			<td><img class="grid" src="01/0.jpg"  /></td>
			<td><img class="grid" src="01/0.jpg"  /></td>
			<td><img class="grid" src="01/0.jpg"  /></td>
			<td><img class="grid" src="01/0.jpg"  /></td>
		</tr>
	</table>
</body>
</html>